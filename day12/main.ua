#!/usr/bin/env uiua
# Experimental!

Parse â† +â‚ -@A âŠœâˆ˜ âŠ¸â‰ @\n

Cardinals â† comptime[0_1_0 1_0_1 0_1_0]
Border!   â† â¥(â‡Œâ‰ â¬š^0â†¯âœâŠ¢+â‚âŠ¸â–³) 4

PartOne â† (
  Cardinals  # Throw cardinal NSWE directions on the stack.
  Border!âˆ , # Surround the map with inf borders.
  â§ˆâˆ˜ 3_3     # Grab 3x3 cells. (Borders above for edges.)
  # Minor complaint about stencil: can only do multi-dimensional windows with
  # a monadic function, which is kinda tedious.
  # For each 3x3 window, check cardinal elements and see if they're the same as
  # the center. Mask out the other cells. Subtract the number of those from 4
  # and that gets the number of edges. I think I could also do this with rows
  # over coords (e.g., using â¬šâˆâŠ¡).
  âœ/âŠ‚â‰¡âŒŸ(+â‚„Â¯/+â™­=âŠƒ(âŠ¡1_1)Ã—)
  # Originally used group for this and got the wrong result. Turns out
  # partition works on multidimensional arrays exactly the way you'd want it
  # to, though. So, this can compute the cost of regions per-partition (i.e.,
  # area = length, edges = sum).
  /+ğ„ˆâŠœ(Ã—âŠƒâ§»/+)
)

M â† â£(
  1 â¤.â‰1_1_1_0
| 1 â¤.â‰1_1_0_1
| 1 â¤.â‰1_0_1_1
| 1 â¤.â‰1_0_1_1
) (0)

# Adjust offsets for a region to surround it with zeros when turning it back
# into a mask. Don't use Border! since we can save a bit by letting unwhere do
# most of the work.
Region â† âœâŠ¡â‹…0:Â°âŠšâ¤šâŠ‚+â‚âŠ¸/â†¥ +â‚
N      â† /+â™­
Diag   â† =â‚/+âˆŠ[0_1]
# Make sure diag does the right thing.
â¤âŸœDiag [0_1 1_0]
â¤âŸœDiag [1_0 0_1]
â¤âŸœ(Â¬Diag) [1_0 1_0]
â¤âŸœ(Â¬Diag) [0_1 0_1]
â¤âŸœ(Â¬Diag) [1_1 0_0]
â¤âŸœ(Â¬Diag) [0_0 1_1]

Corner  â† â¨¬(0|1|Ã—â‚‚Diag|1|0) âŠ¸N
Corners â† /+â™­â§ˆmemoCorner 2_2 Region

# Build a mask of each region and compute the number of cells in it (just the
# length from unpick) and the number of edges by the number of corners. Use
# thread pooling just to speed some of this up because it's really not very
# fast.
PartTwo â† /+wait âŠœpool(Ã—âŠƒCornersâ§») :Â°âŠ¡

â†˜â‚&args
â‰¡(Parse &fras
  {âŠƒPartOne PartTwo}
  â‰¡(&p$"Part _: _")+â‚Â°âŠ)
